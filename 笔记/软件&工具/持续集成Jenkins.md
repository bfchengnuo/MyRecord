# 持续集成Jenkins

根据 Wiki 的介绍：

> Jenkins 是一款由 Java 编写的开源的持续集成工具。在与 Oracle 发生争执后，项目从 Hudson 项目复刻。

果然，Oracle 真的很不受程序员待见啊 2333，可惜了 Sun 这么好的一家公司，Hudson 本来也是 Sun 的。

目前更新进度：

- 基本使用 ✓
- 高级使用 ✕

## 运作原理

简单讲，以 Git 为例：当你推送代码后，会触发一个 Web Hook 通知 Jenkins，当 Jenkins 收到后，会使用 git 插件从代码库拉取最新的代码，然后使用 maven 工具进行打包构建，最后通过部署插件将应用发布到服务器上。

## 使用

Jenkins 的安装或者说运行非常简单，你可以直接用 Docker Run，或者下载各平台的安装包，或者 War 包（可执行的），在官方的[文档中](https://jenkins.io/zh/doc/book/installing/)写的很详细。

启动完成后直接在浏览器访问即可，跟普通的 Web 应用没啥区别，并且支持中文，非常友好。

## 配置

### 安全

打开允许新用户注册，防止忘记密码。

授权里面如果测试系统可以选任意。

CSRF 可以关闭，有可能影响钩子。

### 全局配置

主要就是配一下 Maven 的配置文件路径，JDK、Git、SVN 之类。

### 插件

用什么版本控制就装对应的插件，然后部署的话是 **Deploy to container** 插件

## 创建项目

根据向导一步步来就行，选择构建自由风格的项目，然后输入代码库地址和账号密码。

构建选择 Invoke top-level Maven targets，然后输入 Maven 命令 `clean install` 即可。

其他保持默认就好了。

至此，就可以点立即构建了。

---

检查构建没问题的话，就可以继续配之后的“构建后操作”选项，例如部署到相应的服务器。

> 如果是传统的发布到 Tomcat 容器，需要配置 Tomcat 的用户，并且需要配置相关权限，相关的配置不再多说，用到搜索后补充。

## 设置钩子

在 Jenkins 的项目配置页，有一个构建触发器，选择**触发远程构建**，原理都是一样的，通过访问 Jenkins 的一个地址来触发 Jenkins 的构建。

至于这个地址，它会在输入的时候提示你的。

> SVN：在地址最后加 `@HEAD` 让其拉取最新版本，不受服务器之间的时间影响。