# Java中的Class对象

Class 对象是存放在堆区的，不是方法区，这点很多人容易犯错。

类的元数据（元数据并不是类的 Class 对象。Class 对象是加载的最终产品，类的方法代码，变量名，方法名，访问权限，返回值等等都是在方法区的）才是存在方法区的。 

因为方法区是被所有线程共享的，所以必须考虑数据的线程安全。假如两个线程都在试图找 lava 的类，在 lava 类还没有被加载的情况下，只应该有一个线程去加载，而另一个线程等待。

方法区的大小不必是固定的，jvm 可以根据应用的需要动态调整。同样方法区也不必是连续的。方法区可以在堆(甚至是虚拟机自己的堆)中分配。jvm 可以允许用户和程序指定方法区的初始大小，最小和最大尺寸。

方法区同样存在垃圾收集，因为通过用户定义的类加载器可以动态扩展 java 程序，一些类也会成为垃圾。jvm可以回收一个未被引用类所占的空间，以使方法区的空间最小。

每个数组属于被映射为 Class 对象的一个类，所有具有**相同**元素类型和**维数**的数组都共享该 Class 对象。 

Class 对象在任何实例之前创建，所有对象共享同一个 Class。 

## Class类简介

在 java 世界里，一切皆对象。从某种意义上来说，java 有两种对象：

实例对象和 Class 对象。

每个类的运行时的**类型信息**就是用 Class 对象表示的。它包含了与类有关的信息。其实我们的**实例对象就通过 Class 对象来创建的**。

Java使用 Class 对象执行其 RTTI（运行时类型识别，Run-Time Type Identification），多态是基于 RTTI 实现的。

每一个类都有一个 Class 对象，每当编译一个新类就产生一个 Class 对象，基本类型 (boolean, byte, char, short, int, long, float, and double)有 Class 对象，数组有 Class 对象，就连关键字 void 也有 Class 对象（void.class）。

Class 对象对应着 java.lang.Class 类，如果说类是对象抽象和集合的话，那么 Class 类就是对类的抽象和集合。

Class 类没有公共的构造方法，Class 对象是在类加载的时候由 **Java虚拟机** 以及通过调用类加载器中的 defineClass 方法自动构造的，因此不能显式地声明一个 Class 对象。一个类被加载到内存并供我们使用需要经历如下三个阶段：

1. **加载**。
   这是由类加载器（ClassLoader）执行的。
   通过一个类的全限定名来获取其定义的二进制字节流（Class字节码），将这个字节流所代表的静态存储结构转化为方法去的运行时数据接口，**根据字节码在 java 堆中生成一个代表这个类的 java.lang.Class 对象**。
2. **链接**。
   在链接阶段将验证 Class 文件中的字节流包含的信息是否符合当前虚拟机的要求，为静态域分配存储空间并设置类变量的初始值（默认的零值），并且如果必需的话，将常量池中的符号引用转化为直接引用。
3. **初始化**。
   到了此阶段，才真正开始执行类中定义的java程序代码。用于执行该类的静态初始器和静态初始块，如果该类有父类的话，则优先对其父类进行初始化。

**所有的类都是在对其第一次使用时，动态加载到JVM中的（懒加载）。**当程序创建第一个对类的静态成员的引用时，就会加载这个类。使用 new 创建类对象的时候也会被当作对类的静态成员的引用。**因此java程序程序在它开始运行之前并非被完全加载，其各个类都是在必需时才加载的。**这一点与许多传统语言都不同。动态加载使能的行为，在诸如C++这样的静态加载语言中是很难或者根本不可能复制的。

在类加载阶段，类加载器首先检查这个类的 Class 对象是否已经被加载。如果尚未加载，默认的类加载器就会根据类的全限定名查找 .class 文件。在这个类的字节码被加载时，它们会接受验证，以确保其没有被破坏，并且不包含不良 java 代码。一旦某个类的 Class 对象被载入内存，我们就可以它来创建这个类的所有对象。

## 如何获得Class对象

有三种获得 Class 对象的方式：

1. Class.forName(“类的全限定名”)
2. 实例对象.getClass()
3. 类名.class （类字面常量）

## 参考&拓展

https://blog.csdn.net/mcryeasy/article/details/52344729

[深入理解 Class 与反射](https://blog.csdn.net/javazejian/article/details/70768369)